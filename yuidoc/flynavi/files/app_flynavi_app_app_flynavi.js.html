<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app\flynavi\app\app_flynavi.js - flynavi</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="flynavi"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/mapHandler.html">mapHandler</a></li>
            
                <li><a href="../classes/MapModel.Constant.html">MapModel.Constant</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app\flynavi\app\app_flynavi.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Created with JetBrains WebStorm.
 * User: qcgm1978
 * Date: 6/27/13
 * Time: 3:45 PM
 * Use:
 */
require.config({
    baseUrl: &#x27;scripts&#x27;,
    paths: {
//            todo use jsonp definition to refer map api http://requirejs.org/docs/api.html#jsfiles
//            mapApi:&quot;http://webapi.amap.com/maps?v=1.2&amp;key=0aa17a679101794a2bc8979b3eb332a7&quot;,
        mapModel: &#x27;../flynavi/app/model/map-model&#x27;,
        controllerMap: &#x27;../flynavi/app/controller/controller_start&#x27;,
        navInfo: &#x27;../flynavi/app/controller/controller_naviInfo&#x27;,
        toolsFlynavi: &#x27;../flynavi/app/util/tools_flynavi&#x27;,
        jquery: &#x27;../bower_components/jquery/jquery&#x27;,
        jqueryMigrate: &#x27;../bower_components/jquery-migrate/jquery-migrate&#x27;,
        jquerymx: &#x27;../bower_components/jquerymx/jquerymx&#x27;,
        tools: &quot;util/tools&quot;,
        mapUtil: &quot;util/mapUtil&quot;,
        tbt: &#x27;lib/tbt&#x27;,
        toolBar: &#x27;controller/Toolbar&#x27;,
        Layer: &#x27;controller/Layer&#x27;,
        map: &#x27;controller/Map&#x27;,
        mapHandler: &#x27;model/mapHandler&#x27;,
        webRoute: &#x27;lib/webroute&#x27;,
        iScroll: &#x27;../bower_components/iScroll4.2.5/iscroll&#x27;,
        app: &#x27;app&#x27;,
        tab: &#x27;controller/Tab&#x27;,
        link: &#x27;controller/Link&#x27;,
        pathDrawing: &#x27;model/pathDrawing&#x27;,
        route: &#x27;model/routeInfo&#x27;,
        networkDetect: &#x27;model/networkCommunication&#x27;,
        historyController: &#x27;controller/historyController&#x27;,
        trafficLayer: &#x27;../flynavi/app/controller/controller_maskerlayer&#x27;
    },
    shim: {
        mapModel: {
            deps: [ &#x27;mapUtil&#x27;, &#x27;iScroll&#x27;, &#x27;tbt&#x27;]
        },
        navInfo: {
            deps: [&#x27;jquerymx&#x27;]
        },
        toolsFlynavi: {
            deps: [&#x27;jquerymx&#x27;, &#x27;tools&#x27;]
        },
        jqueryMigrate: {
            deps: [&#x27;jquery&#x27;]
        },
        jquerymx: {
//            change jquery dependency to  jqueryMigrate if needed
            deps: [&#x27;jquery&#x27;]
        },
        toolBar: {
            deps: [&#x27;tools&#x27;]
        },
        mapHandler: {
            deps: [&#x27;jquerymx&#x27;, &#x27;mapModel&#x27;]
        },
        tbt: {
            deps: [&#x27;jquerymx&#x27;, &#x27;webRoute&#x27;]
        }
    }
});
/**
 @param {Boolean|Null|Object} appRet
 the ret val of app module. false if no network connection, null if no shared data, object if shared data exists
 **/

require([&#x27;app&#x27;,&#x27;navInfo&#x27;, &#x27;trafficLayer&#x27;, &#x27;toolsFlynavi&#x27;], function (appRet) {
    if(!appRet){
        return;
    }
//todo loaded module generate global var so requireJs hasn&#x27;t effect on avoiding global var
    mapHandler
        .bind(&#x27;shareInfo&#x27;, function (ev, newVal) {
            if (newVal == null) {
                return;
            }
            var configShare = {
                lng: this.getShareLngLat().lng,
                lat: this.getShareLngLat().lat,
                id: &#x27;share_pos&#x27;,
                imgAddress: &#x27;flynavi/resources/images/share_position.png&#x27;,
                imgWidth:53,
                imgHeight: 41
            };
            var height = $(&#x27;body&#x27;).height() - $(&#x27;#header&#x27;).height() - $(&#x27;#link_bar&#x27;).height();
            $(&#x27;#map_container&#x27;).height(height);
            this.showMap();
            this.shareMarker = this.addMarker(configShare);
            //this.addShareInfoWindow(this.getShareLngLat().lng, this.getShareLngLat().lat);
            $(&#x27;#share_name&#x27;).text(&#x27;(&#x27; + util_common.truncateStr(mapHandler.shareInfo.name, 20) + &#x27;)&#x27;);
            $(&#x27;#share_address&#x27;).text(mapHandler.shareInfo.address);



            ;
        })
        .bind(&#x27;curInfo&#x27;, function (ev, newVal) {
            if (this.mapObj == null) {
                return;
            }
//        如果已经添加了当前位置覆盖物，返回
            if (this.mapObj &amp;&amp; this.mapObj.getOverlays(&#x27;cur_pos&#x27;)) {
                this.moveCurMarker();
            }
            else {
                var configCur = {
                    lng: this.curInfo.lng,
                    lat: this.curInfo.lat,
                    id: &#x27;cur_pos&#x27;,
                    imgAddress: &#x27;images/cur_position.png&#x27;,
                    imgWidth: common.SHARE_POS_METRIC,
                    imgHeight: common.SHARE_POS_METRIC
                };
                this.curMarker = this.addMarker(configCur);
            }
            this.rotateCurMarkerOrMap();
        });
    bodyLoad();
    mapHandler.attr(&#x27;shareInfo&#x27;, appRet);
    //加载完body元素后切换启动页
    function bodyLoad() {
        $(&#x27;#main&#x27;).css(&#x27;display&#x27;, &#x27;block&#x27;);
        $(&#x27;#start&#x27;).css(&#x27;display&#x27;, &#x27;none&#x27;);
        setTimeout(function () {
            window.scrollTo(0, 1);
        }, 100);
    }

    bindFocusEve();
    location.hash = &#x27;#share&#x27;;
    //定位按钮等待状态
    var position_interval = null;
    void function () {
        var num = 0
        position_interval = setInterval(function () {
            /*填加自车位置后，隐藏正在定位按钮样式*/
            if (mapHandler.mapObj &amp;&amp; mapHandler.mapObj.getOverlays(&#x27;cur_pos&#x27;)) {
                positionStateEnd();
            }
            var angle = 45 * num;
            num++;
            $(&#x27;#positionLight&#x27;).css({
                &#x27;-webkit-Transform&#x27;: &#x27;rotate(&#x27; + angle + &#x27;deg)&#x27;
            }, 200)
            if (num == 8) {
                num = 0;
            }
        }, 150);
    }();
    function positionStateEnd() {
        clearInterval(position_interval);
        $(&#x27;#positionLight&#x27;).removeClass(&#x27;loading&#x27;).hide();
    }

    new Map($(&#x27;#navi&#x27;));
    navInfo = new NaviInfo($(&#x27;#path_info&#x27;));
    var config = {
        unit:  &#x27;千米/小时&#x27;,
        arrTrafficCol: common.pathColor
    };
    routeObj = new Route(config);
    routeObj.attr(&#x27;totalWidth&#x27;, ($(document.body).width() - $(&#x27;.tabsContent_table th&#x27;).eq(0).width() - $(&#x27;.tabsContent_table th&#x27;).eq(2).width()) / 2);
    new Tab($(&#x27;#route&#x27;), {routeObj: routeObj});
    $(window).fly_shared_history({
        routeObj: routeObj,
        toolbar: toolbar
    });

    new MaskLayer($(&#x27;#mask_layer&#x27;));
    followDev.attr(&#x27;isPollGps&#x27;, true);
    return true;
})
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
